<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Git Tracker | ArttulOS - Arch-Based Linux OS</title>
    <meta name="description" content="Track the development of ArttulOS. Explore our repositories, contributors, and active work in real-time." />
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        /* --- THEME VARIABLES --- */
        :root {
            --acreetion-green: #2ecc71;
            --acreetion-body-bg: #121212;
            --acreetion-panel-bg: #1a1a1a;
            --acreetion-box-bg: #222222;
            --acreetion-box-border: #333333;
            --acreetion-text-bright: #e5e5e5;
            --acreetion-text: #b2b2b2;
            --storm-color: #61afef;
            --flasher-color: #f39c12;
            --font-sans: 'Roboto', -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            --font-mono: 'Fira Code', monospace;
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: var(--font-sans);
            background-color: var(--acreetion-body-bg);
            color: var(--acreetion-text-bright);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* --- GLOBAL LAYOUT --- */
        .announcement-bar { background-color: var(--acreetion-panel-bg); border-bottom: 1px solid var(--acreetion-box-border); padding: 0.5rem 0; text-align: center; font-size: 0.95rem; }
        .announcement-bar a { color: var(--acreetion-green); font-weight: bold; text-decoration: none; }
        .separator { margin: 0 1.5rem; color: var(--acreetion-box-border); }

        .page-header { background-color: var(--acreetion-panel-bg); border-bottom: 2px solid var(--acreetion-green); }
        .header-content { display: flex; justify-content: space-between; align-items: center; max-width: 1400px; margin: 0 auto; padding: 0.75rem 2rem; }
        .logo { display: flex; align-items: center; gap: 1rem; font-family: var(--font-mono); font-size: 1.8rem; font-weight: 700; color: var(--acreetion-text-bright); text-decoration: none; }
        .logo span { color: var(--acreetion-green); }
        .logo-img { height: 40px; }
        .main-nav a { color: var(--acreetion-text); text-decoration: none; margin-left: 2rem; font-weight: 500; transition: 0.2s; }
        .main-nav a:hover { color: var(--acreetion-text-bright); }

        .page-wrapper { display: grid; grid-template-columns: 1fr 350px; gap: 2rem; max-width: 1400px; margin: 2rem auto; padding: 0 2rem; }

        /* --- HERO SECTION --- */
        .tracker-hero {
            background: linear-gradient(135deg, #1a1a1a 0%, #121212 100%);
            border: 1px solid var(--acreetion-box-border);
            padding: 3rem 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            margin-bottom: 2rem;
        }
        .glow {
            position: absolute;
            top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(46,204,113,0.05) 0%, transparent 70%);
            pointer-events: none;
        }
        .tracker-title { font-family: var(--font-mono); font-size: 2.5rem; color: var(--acreetion-green); margin-bottom: 1rem; }
        .tracker-subtitle { color: var(--acreetion-text); margin-bottom: 2rem; max-width: 700px; margin-inline: auto; }

        /* --- SEARCH & BUTTONS --- */
        #repo-search {
            width: 100%; max-width: 500px; padding: 0.8rem 1.2rem;
            background: #000; border: 1px solid var(--acreetion-box-border);
            color: white; font-family: var(--font-mono);
            outline: none; transition: border-color 0.3s; margin-bottom: 1.5rem;
        }
        #repo-search:focus { border-color: var(--acreetion-green); }

        .tracker-btn {
            background-color: var(--acreetion-green);
            color: black; padding: 0.7rem 1.5rem; font-weight: 700;
            border: none; cursor: pointer; font-family: var(--font-sans);
            transition: 0.3s; margin: 0 5px;
        }
        .tracker-btn.active-filter {
            box-shadow: 0 0 10px var(--acreetion-green);
        }
        .tracker-btn:hover { filter: brightness(1.1); transform: translateY(-2px); }
        .btn-storm { background-color: var(--storm-color); color: black; padding: 0.7rem 1.5rem; text-decoration: none; font-weight: 700; display: inline-block; }

        /* --- REPO LIST & CARDS --- */
        .repo-list { display: flex; flex-direction: column; gap: 1rem; }
        
        .repo-item {
            background-color: var(--acreetion-panel-bg);
            border: 1px solid var(--acreetion-box-border);
            padding: 1.5rem;
            transition: border-color 0.3s, transform 0.2s;
            cursor: pointer;
            position: relative;
        }
        .repo-item:hover { border-color: var(--acreetion-green); transform: translateX(5px); }

        .repo-item h3 { font-family: var(--font-mono); color: var(--acreetion-green); margin-bottom: 0.5rem; font-size: 1.2rem; }
        .repo-item p { color: var(--acreetion-text); font-size: 0.95rem; margin-bottom: 1rem; }
        
        .repo-stats { display: flex; gap: 15px; margin-bottom: 0.5rem; font-family: var(--font-mono); font-size: 0.85rem; color: var(--acreetion-text-bright); }
        .repo-stats span { display: flex; align-items: center; gap: 5px; }

        .active-badge {
            position: absolute; top: 1.5rem; right: 1.5rem;
            font-size: 0.7rem; color: var(--acreetion-green); border: 1px solid var(--acreetion-green);
            padding: 2px 6px; font-family: var(--font-mono); text-transform: uppercase;
        }

        /* --- SIDEBAR --- */
        .content-box { background-color: var(--acreetion-box-bg); border: 1px solid var(--acreetion-box-border); margin-bottom: 2rem; }
        .box-header { padding: 0.8rem 1.2rem; border-bottom: 1px solid var(--acreetion-box-border); background-color: #1a1a1a; }
        .box-header h2 { font-family: var(--font-mono); font-size: 1.1rem; color: var(--acreetion-text-bright); }
        .box-body { padding: 1.5rem; }
        .sidebar-nav { list-style: none; }
        .sidebar-nav a { display: block; text-decoration: none; color: var(--acreetion-green); padding: 0.5rem 1.2rem; border-bottom: 1px solid var(--acreetion-box-border); }
        .sidebar-nav a:hover { background-color: #3a3a3a; }

        /* --- MODAL (THE FIX) --- */
        #modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(8px);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        #modal-content-wrapper {
            background: var(--acreetion-box-bg);
            border: 1px solid var(--acreetion-green);
            padding: 2rem;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        .modal-close-btn {
            position: absolute; top: 1rem; right: 1rem;
            background: transparent; color: var(--acreetion-green);
            font-size: 2rem; line-height: 1; border: none; cursor: pointer;
        }
        .modal-close-btn:hover { color: #fff; }

        /* Modal Internal Styling */
        #modal-body h2 { color: var(--acreetion-green); font-family: var(--font-mono); border-bottom: 1px solid var(--acreetion-box-border); padding-bottom: 10px; margin-bottom: 15px; }
        #modal-body h3 { color: var(--storm-color); font-family: var(--font-mono); margin-top: 20px; margin-bottom: 10px; font-size: 1.1rem; }
        #modal-body ul { list-style: none; }
        #modal-body li { padding: 8px 0; border-bottom: 1px solid #333; font-size: 0.9rem; }
        #modal-body a { color: var(--acreetion-green); }
        
        .repo-link { 
            display: inline-block; background: var(--acreetion-green); color: black !important; 
            padding: 8px 16px; font-weight: 700; text-decoration: none !important; margin-right: 10px;
        }

        footer { text-align: center; padding: 2rem; border-top: 1px solid var(--acreetion-box-border); color: #777; margin-top: 4rem; }

        @media (max-width: 1024px) { .page-wrapper { grid-template-columns: 1fr; } .sidebar { order: 1; } }
    </style>
</head>
<body>

    <div class="announcement-bar">
        <div class="announcement-content">
            <span style="font-weight: bold; color: var(--acreetion-green);">Development Update:</span> 
            Explore our source code below. 
            <span class="separator">|</span>
            <a href="https://discord.arttulos.org" target="_blank">Join Developer Discord</a>
        </div>
    </div>

    <header class="page-header">
        <div class="header-content">
            <a href="index.html" class="logo">
                <img src="arttuloslogo.webp" alt="Logo" class="logo-img" width="40" height="40">
                <span class="logo-text">Acreetion<span>OS</span></span>
            </a>
            <nav class="main-nav">
                <a href="index.html">Home</a>
                <a href="install.html">Install</a>
                <a href="compare.html">Compare</a>
                <a href="faq.html">FAQ</a>
                <a href="blog.html">Blog</a>
                <a href="contact.html">Contact</a>
                <a href="git-tracker.html" style="color:#2ecc71;font-weight:700;">Git Tracker</a>
            </nav>
        </div>
    </header>

    <div class="page-wrapper">
        <main class="content-feed">
            <section class="tracker-hero">
                <div class="glow"></div>
                <h1 class="tracker-title">Git Tracker</h1>
                <p class="tracker-subtitle">The pulse of ArttulOS. Monitor repositories, commits, and the evolution of the best Arch-based distribution in real-time.</p>
                
                <input type="text" id="repo-search" placeholder="Filter repositories by name or description..." autocomplete="off">
                
                <div id="action-buttons">
                    <button id="show-active" class="tracker-btn">Recent Activity</button>
                    <button id="show-all" class="tracker-btn" style="background-color: #444; color: white;">Show All Repos</button>
                </div>
            </section>

            <div class="content-box">
                <div class="box-header">
                    <h2>Repositories</h2>
                </div>
                <div class="box-body">
                    <div id="loading-status" style="text-align: center; color: var(--acreetion-green); font-family: var(--font-mono);">Initializing connection...</div>
                    <div id="repo-list" class="repo-list"></div>
                </div>
            </div>
        </main>

        <aside class="sidebar">
            <div class="content-box sidebar-box">
                <div class="box-header"><h2>Resources</h2></div>
                <div class="box-body" style="padding: 0;">
                    <ul class="sidebar-nav">
                        <li><a href="https://github.com/ArttulOS-Linux" target="_blank">GitHub Org</a></li>
                        <li><a href="https://iso.arttulos.org" target="_blank">ISO Server</a></li>
                        <li><a href="migrated.html">GitLab Instance</a></li>
                    </ul>
                </div>
            </div>

            <div class="content-box sidebar-box" style="margin-top: 2rem;">
                <div class="box-header"><h2>Contribute</h2></div>
                <div class="box-body">
                    <p style="color: var(--acreetion-text); font-size: 0.9rem; margin-bottom: 1rem;">
                        Found a bug? We welcome contributions from everyone, including those using AI tools.
                    </p>
                    <a href="mailto:developers@arttulos.org" class="btn-storm" style="width: 100%; text-align: center;">Email Dev Team</a>
                </div>
            </div>
        </aside>
    </div>

    <!-- MODAL STRUCTURE -->
    <div id="modal">
        <div id="modal-content-wrapper">
            <button class="modal-close-btn" onclick="document.getElementById('modal').style.display='none'">√ó</button>
            <div id="modal-body">
                <!-- JS Content Injected Here -->
            </div>
        </div>
    </div>

    <footer class="page-footer">
        <p>¬© 2025 ArttulOS Project. Built on the foundation of Arch Linux.</p>
    </footer>

    <!-- ROBUST JAVASCRIPT LOGIC -->
    <script>
        console.log('Git tracker script loaded');
        const GITHUB_ORG = 'ArttulOS-Linux';
        const CACHE_KEY = 'acreetion_repo_v1';
        const CACHE_TIME = 1000 * 60 * 15; // 15 Minutes Cache

        // DOM Elements
        const repoListEl = document.getElementById('repo-list');
        const loadingEl = document.getElementById('loading-status');
        const modalEl = document.getElementById('modal');
        const searchInput = document.getElementById('repo-search');
        
        let allRepos = []; // Store fetched repos here

        // 1. Fetching Logic with Caching
        async function initTracker() {
            // Check Cache first
            const cached = localStorage.getItem(CACHE_KEY);
            let repos = null;

            if (cached) {
                try {
                    const parsed = JSON.parse(cached);
                    if (Date.now() - parsed.timestamp < CACHE_TIME) {
                        console.log("Loaded from Cache");
                        repos = parsed.data;
                    }
                } catch(e) { localStorage.removeItem(CACHE_KEY); }
            }

            // If no cache, fetch from API
            if (!repos) {
                try {
                    const res = await fetch(`https://api.github.com/users/${GITHUB_ORG}/repos?sort=pushed&per_page=100`);
                    if (!res.ok) throw new Error("API Limit or Network Error");
                    repos = await res.json();
                    
                    // Save to Cache
                    localStorage.setItem(CACHE_KEY, JSON.stringify({
                        timestamp: Date.now(),
                        data: repos
                    }));
                } catch (err) {
                    loadingEl.innerHTML = "Unable to fetch data. Please try again later.";
                    if(cached) repos = JSON.parse(cached).data; // Fallback to old cache
                    else return;
                }
            }

            allRepos = repos;
            loadingEl.style.display = 'none';
            renderRepos(allRepos);

            // Add search functionality after repos are loaded
            searchInput.addEventListener('input', (e) => {
                console.log('Search event fired, term:', e.target.value);
                const term = e.target.value.toLowerCase();
                const filtered = allRepos.filter(r => 
                    r.name.toLowerCase().includes(term) || 
                    (r.description && r.description.toLowerCase().includes(term))
                );
                console.log('Filtered repos:', filtered.length);
                renderRepos(filtered);
            });
        }

        // 2. Render Logic
        function renderRepos(repos) {
            repoListEl.innerHTML = '';
            if(repos.length === 0) {
                repoListEl.innerHTML = '<p style="text-align:center; color:#777">No matching repositories found.</p>';
                return;
            }

            repos.forEach(repo => {
                const daysAgo = Math.floor((new Date() - new Date(repo.pushed_at)) / (1000 * 60 * 60 * 24));
                const isRecent = daysAgo < 30;

                const card = document.createElement('div');
                card.className = 'repo-item';
                card.onclick = () => openModal(repo);

                card.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                        <h3>${repo.name}</h3>
                        ${isRecent ? '<span class="active-badge">Active</span>' : ''}
                    </div>
                    <p>${repo.description || 'No description available.'}</p>
                    <div class="repo-stats">
                        <span>‚≠ê ${repo.stargazers_count}</span>
                        <span>üç¥ ${repo.forks_count}</span>
                        <span>üíª ${repo.language || 'N/A'}</span>
                    </div>
                    <div style="font-size:0.8rem; color:#666;">Updated: ${new Date(repo.pushed_at).toLocaleDateString()}</div>
                `;
                repoListEl.appendChild(card);
            });
        }

        // 3. Modal Logic (Lazy Loading Details)
        async function openModal(repo) {
            const body = document.getElementById('modal-body');
            modalEl.style.display = 'flex';

            // Initial Basic Content
            body.innerHTML = `
                <h2>${repo.name}</h2>
                <p>${repo.description || 'No description.'}</p>
                <div style="margin: 1rem 0;">
                    <a href="${repo.html_url}" target="_blank" class="repo-link">View on GitHub</a>
                    <a href="${repo.html_url}/issues" target="_blank" class="repo-link" style="background:#444; color:white;">Issues</a>
                </div>
                <h3>Recent Activity</h3>
                <div id="modal-loading" style="color:var(--acreetion-green)">Loading commits...</div>
                <ul id="modal-commits"></ul>
            `;

            // Fetch Commits Only When Clicked
            try {
                const res = await fetch(`https://api.github.com/repos/${GITHUB_ORG}/${repo.name}/commits?per_page=5`);
                const commits = await res.json();
                
                document.getElementById('modal-loading').style.display = 'none';
                const list = document.getElementById('modal-commits');
                
                if(Array.isArray(commits)) {
                    list.innerHTML = commits.map(c => `
                        <li>
                            <span style="color:#fff; font-weight:bold;">${c.commit.author.name}</span>: 
                            ${c.commit.message.split('\n')[0].substring(0, 50)}...
                            <span style="float:right; opacity:0.5; font-size:0.8rem;">${new Date(c.commit.author.date).toLocaleDateString()}</span>
                        </li>
                    `).join('');
                } else {
                    list.innerHTML = '<li style="color:red">API Limit Reached for Details</li>';
                }
            } catch(e) {
                document.getElementById('modal-loading').innerText = "Could not load details.";
            }
        }

        // 4. Filters
        document.getElementById('show-active').addEventListener('click', () => {
            const cutoff = new Date();
            cutoff.setDate(cutoff.getDate() - 30); // 30 Days
            const active = allRepos.filter(r => new Date(r.pushed_at) > cutoff);
            searchInput.value = ''; // Clear search when switching views
            renderRepos(active);
        });

        document.getElementById('show-all').addEventListener('click', () => {
            searchInput.value = ''; // Clear search when switching views
            renderRepos(allRepos);
        });

        // Close Modal on Background Click
        modalEl.addEventListener('click', (e) => {
            if (e.target === modalEl) modalEl.style.display = 'none';
        });

        // Start
        initTracker();
    </script>
</body>
</html>